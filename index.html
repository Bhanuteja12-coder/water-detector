<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>Real-Time Object Detector</title>
<style>
  body { 
    background:#111; 
    color:#eee; 
    font-family:Arial; 
    text-align:center; 
    margin:0;
    padding:20px;
  }
  #videoContainer {
    position: relative;
    display: inline-block;
    margin-top: 20px;
  }
  video { 
    width:100%; 
    max-width:640px; 
    border:3px solid #0ff; 
    border-radius:10px;
    display: block;
  }
  canvas {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
  }
  #status { 
    margin-top:20px; 
    font-size:20px; 
    color: #0ff;
  }
  #detections {
    margin-top: 20px;
    padding: 20px;
    background: #222;
    border-radius: 10px;
    max-width: 640px;
    margin-left: auto;
    margin-right: auto;
  }
  .detection-item {
    padding: 10px;
    margin: 5px 0;
    background: #333;
    border-radius: 5px;
    font-size: 18px;
  }
  .object-name {
    color: #0ff;
    font-weight: bold;
  }
  .confidence {
    color: #0f0;
    font-size: 14px;
  }
</style>
</head>
<body>
<h2>üéØ Real-Time Object Detector</h2>

<div id="status">Loading AI model...</div>

<div id="videoContainer">
  <video id="video" autoplay playsinline></video>
  <canvas id="canvas"></canvas>
</div>

<div id="detections"></div>

<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.11.0"></script>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/coco-ssd@2.2.3"></script>

<script>
(async () => {
    const video = document.getElementById("video");
    const canvas = document.getElementById("canvas");
    const ctx = canvas.getContext("2d");
    const status = document.getElementById("status");
    const detectionsDiv = document.getElementById("detections");
    
    let model = null;

    // Start webcam with back camera
    try {
        const stream = await navigator.mediaDevices.getUserMedia({ 
            video: { 
                facingMode: { ideal: "environment" },
                width: { ideal: 640 },
                height: { ideal: 480 }
            } 
        });
        video.srcObject = stream;
        
        video.addEventListener('loadeddata', () => {
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
        });
        
    } catch (e) {
        status.textContent = "‚ùå Camera error: " + e.message;
        return;
    }

    // Load COCO-SSD model
    try {
        status.textContent = "ü§ñ Loading AI model...";
        model = await cocoSsd.load();
        status.textContent = "‚úÖ Ready! Point camera at objects";
        status.style.color = "#0f0";
        detectObjects();
    } catch (e) {
        status.textContent = "‚ùå Error loading model: " + e.message;
        return;
    }

    async function detectObjects() {
        if (!model) return;

        // Run detection
        const predictions = await model.detect(video);
        
        // Clear canvas
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        
        // Draw bounding boxes and labels
        ctx.font = "18px Arial";
        ctx.lineWidth = 3;
        
        let detectionsHTML = "";
        
        if (predictions.length === 0) {
            detectionsHTML = '<div class="detection-item">No objects detected</div>';
        } else {
            predictions.forEach((prediction, index) => {
                const [x, y, width, height] = prediction.bbox;
                const confidence = (prediction.score * 100).toFixed(1);
                
                // Draw box
                ctx.strokeStyle = "#0ff";
                ctx.fillStyle = "#0ff";
                ctx.strokeRect(x, y, width, height);
                
                // Draw label background
                const label = `${prediction.class} ${confidence}%`;
                const textWidth = ctx.measureText(label).width;
                ctx.fillStyle = "#0ff";
                ctx.fillRect(x, y - 25, textWidth + 10, 25);
                
                // Draw label text
                ctx.fillStyle = "#000";
                ctx.fillText(label, x + 5, y - 7);
                
                // Add to list
                detectionsHTML += `
                    <div class="detection-item">
                        <span class="object-name">${prediction.class}</span> 
                        <span class="confidence">(${confidence}% confident)</span>
                    </div>
                `;
            });
        }
        
        detectionsDiv.innerHTML = detectionsHTML;
        
        // Continue detection
        requestAnimationFrame(detectObjects);
    }
})();
</script>
</body>
</html>
