<!doctype html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AI Object Detector Pro</title>
<style>
  * { box-sizing: border-box; }
  body { 
    background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 100%);
    color:#eee; 
    font-family: 'Segoe UI', Arial, sans-serif; 
    text-align:center; 
    margin:0;
    padding:20px;
    min-height: 100vh;
  }
  h2 {
    background: linear-gradient(90deg, #00f5ff, #0af, #00ff88);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    font-size: 32px;
    margin-bottom: 10px;
  }
  #controls {
    margin: 20px auto;
    max-width: 640px;
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
    justify-content: center;
  }
  button {
    padding: 12px 24px;
    font-size: 16px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border: none;
    border-radius: 25px;
    cursor: pointer;
    transition: all 0.3s;
    box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
  }
  button:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
  }
  button:active { transform: translateY(0); }
  #videoContainer {
    position: relative;
    display: inline-block;
    margin-top: 20px;
    box-shadow: 0 8px 32px rgba(0, 245, 255, 0.3);
    border-radius: 15px;
    overflow: hidden;
  }
  video { 
    width:100%; 
    max-width:640px; 
    border:3px solid #00f5ff; 
    border-radius:12px;
    display: block;
  }
  canvas {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    border-radius: 12px;
  }
  #status { 
    margin-top:20px; 
    font-size:18px; 
    color: #00f5ff;
    text-shadow: 0 0 10px rgba(0, 245, 255, 0.5);
  }
  #stats {
    margin: 15px auto;
    max-width: 640px;
    display: flex;
    gap: 15px;
    justify-content: center;
    flex-wrap: wrap;
  }
  .stat-box {
    background: rgba(255,255,255,0.05);
    padding: 15px 25px;
    border-radius: 10px;
    border: 1px solid rgba(0, 245, 255, 0.3);
    backdrop-filter: blur(10px);
  }
  .stat-number {
    font-size: 28px;
    font-weight: bold;
    color: #00ff88;
  }
  .stat-label {
    font-size: 12px;
    color: #aaa;
    text-transform: uppercase;
  }
  #detections {
    margin-top: 20px;
    padding: 20px;
    background: rgba(255,255,255,0.05);
    border-radius: 15px;
    max-width: 640px;
    margin-left: auto;
    margin-right: auto;
    backdrop-filter: blur(10px);
    border: 1px solid rgba(0, 245, 255, 0.2);
    max-height: 400px;
    overflow-y: auto;
  }
  #detections::-webkit-scrollbar {
    width: 8px;
  }
  #detections::-webkit-scrollbar-track {
    background: rgba(255,255,255,0.05);
    border-radius: 10px;
  }
  #detections::-webkit-scrollbar-thumb {
    background: #00f5ff;
    border-radius: 10px;
  }
  .detection-item {
    padding: 12px;
    margin: 8px 0;
    background: rgba(255,255,255,0.08);
    border-radius: 8px;
    font-size: 16px;
    transition: all 0.2s;
    border-left: 4px solid #00f5ff;
  }
  .detection-item:hover {
    background: rgba(255,255,255,0.12);
    transform: translateX(5px);
  }
  .object-name {
    color: #00f5ff;
    font-weight: bold;
    text-transform: capitalize;
  }
  .confidence {
    color: #00ff88;
    font-size: 14px;
    float: right;
  }
  #screenshot {
    display: none;
  }
  .fps {
    position: absolute;
    top: 10px;
    right: 10px;
    background: rgba(0,0,0,0.7);
    padding: 5px 10px;
    border-radius: 5px;
    font-size: 14px;
    color: #0f0;
  }
  .toast {
    position: fixed;
    bottom: 30px;
    right: 30px;
    background: #00ff88;
    color: #000;
    padding: 15px 25px;
    border-radius: 10px;
    font-weight: bold;
    animation: slideIn 0.3s ease;
    z-index: 1000;
  }
  @keyframes slideIn {
    from { transform: translateX(400px); opacity: 0; }
    to { transform: translateX(0); opacity: 1; }
  }
</style>
</head>
<body>
<h2>ğŸ¤– AI Object Detector Pro</h2>

<div id="status">Loading AI models...</div>

<div id="stats">
  <div class="stat-box">
    <div class="stat-number" id="objectCount">0</div>
    <div class="stat-label">Objects</div>
  </div>
  <div class="stat-box">
    <div class="stat-number" id="fpsCounter">0</div>
    <div class="stat-label">FPS</div>
  </div>
  <div class="stat-box">
    <div class="stat-number" id="totalDetected">0</div>
    <div class="stat-label">Total Detected</div>
  </div>
</div>

<div id="controls">
  <button id="cameraBtn">ğŸ“· Switch Camera</button>
  <button id="screenshotBtn">ğŸ“¸ Screenshot</button>
  <button id="toggleBoxBtn">ğŸ”² Toggle Boxes</button>
  <button id="clearBtn">ğŸ—‘ï¸ Clear Stats</button>
</div>

<div id="videoContainer">
  <video id="video" autoplay playsinline></video>
  <canvas id="canvas"></canvas>
  <div class="fps" id="fps">0 FPS</div>
</div>

<div id="detections"></div>

<canvas id="screenshot" width="640" height="480"></canvas>

<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.11.0"></script>
<parameter name="coco-ssd@2.2.3"></script>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/mobilenet@2.1.0"></script>

<script>
(async () => {
    const video = document.getElementById("video");
    const canvas = document.getElementById("canvas");
    const ctx = canvas.getContext("2d");
    const screenshotCanvas = document.getElementById("screenshot");
    const screenshotCtx = screenshotCanvas.getContext("2d");
    const status = document.getElementById("status");
    const detectionsDiv = document.getElementById("detections");
    const objectCountEl = document.getElementById("objectCount");
    const fpsCounterEl = document.getElementById("fpsCounter");
    const totalDetectedEl = document.getElementById("totalDetected");
    const fpsEl = document.getElementById("fps");
    
    let cocoModel = null;
    let mobileNetModel = null;
    let currentStream = null;
    let facingMode = "environment"; // back camera
    let showBoxes = true;
    let totalDetections = 0;
    let uniqueObjects = new Set();
    
    // FPS calculation
    let lastTime = performance.now();
    let frameCount = 0;
    let fps = 0;

    // Button handlers
    document.getElementById("cameraBtn").addEventListener("click", switchCamera);
    document.getElementById("screenshotBtn").addEventListener("click", takeScreenshot);
    document.getElementById("toggleBoxBtn").addEventListener("click", () => {
        showBoxes = !showBoxes;
        showToast(showBoxes ? "Boxes ON" : "Boxes OFF");
    });
    document.getElementById("clearBtn").addEventListener("click", () => {
        totalDetections = 0;
        uniqueObjects.clear();
        totalDetectedEl.textContent = "0";
        showToast("Stats Cleared");
    });

    async function switchCamera() {
        facingMode = facingMode === "environment" ? "user" : "environment";
        if (currentStream) {
            currentStream.getTracks().forEach(track => track.stop());
        }
        await startCamera();
        showToast(facingMode === "environment" ? "Back Camera" : "Front Camera");
    }

    async function startCamera() {
        try {
            currentStream = await navigator.mediaDevices.getUserMedia({ 
                video: { 
                    facingMode: facingMode,
                    width: { ideal: 640 },
                    height: { ideal: 480 }
                } 
            });
            video.srcObject = currentStream;
            
            video.addEventListener('loadeddata', () => {
                canvas.width = video.videoWidth;
                canvas.height = video.videoHeight;
            });
            
        } catch (e) {
            status.textContent = "âŒ Camera error: " + e.message;
            throw e;
        }
    }

    function takeScreenshot() {
        screenshotCanvas.width = video.videoWidth;
        screenshotCanvas.height = video.videoHeight;
        screenshotCtx.drawImage(video, 0, 0);
        
        // Draw current detections on screenshot
        screenshotCtx.drawImage(canvas, 0, 0);
        
        // Download
        const link = document.createElement('a');
        link.download = `detection_${Date.now()}.png`;
        link.href = screenshotCanvas.toDataURL();
        link.click();
        
        showToast("ğŸ“¸ Screenshot Saved!");
    }

    function showToast(message) {
        const toast = document.createElement('div');
        toast.className = 'toast';
        toast.textContent = message;
        document.body.appendChild(toast);
        setTimeout(() => toast.remove(), 2000);
    }

    // Start camera
    await startCamera();

    // Load both models
    try {
        status.textContent = "ğŸ¤– Loading AI models (20-30 seconds)...";
        
        cocoModel = await cocoSsd.load({ base: 'mobilenet_v2' });
        mobileNetModel = await mobilenet.load({ version: 2, alpha: 1.0 });
        
        status.textContent = "âœ… AI Ready! Detecting 1000+ object types";
        status.style.color = "#00ff88";
        detectObjects();
    } catch (e) {
        status.textContent = "âŒ Error loading models: " + e.message;
        return;
    }

    const colors = ['#00f5ff', '#f0f', '#ff0', '#0f0', '#f00', '#00f', '#ffa500', '#ff69b4'];

    async function detectObjects() {
        if (!cocoModel || !mobileNetModel) return;

        // Calculate FPS
        frameCount++;
        const currentTime = performance.now();
        if (currentTime - lastTime >= 1000) {
            fps = frameCount;
            fpsCounterEl.textContent = fps;
            fpsEl.textContent = `${fps} FPS`;
            frameCount = 0;
            lastTime = currentTime;
        }

        const cocoDetections = await cocoModel.detect(video, undefined, 0.25);
        const classifications = await mobileNetModel.classify(video, 5);
        
        if (showBoxes) {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
        } else {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
        }
        
        ctx.font = "bold 16px Arial";
        ctx.lineWidth = 3;
        
        let detectionsHTML = "";
        let currentObjects = 0;
        
        if (cocoDetections.length > 0 && showBoxes) {
            cocoDetections.sort((a, b) => b.score - a.score);
            
            cocoDetections.forEach((prediction, index) => {
                const [x, y, width, height] = prediction.bbox;
                const confidence = (prediction.score * 100).toFixed(0);
                const color = colors[index % colors.length];
                
                uniqueObjects.add(prediction.class);
                currentObjects++;
                
                ctx.strokeStyle = color;
                ctx.fillStyle = color;
                ctx.strokeRect(x, y, width, height);
                
                const label = `${prediction.class.toUpperCase()}`;
                const confLabel = `${confidence}%`;
                const textWidth = ctx.measureText(label).width;
                const confWidth = ctx.measureText(confLabel).width;
                
                ctx.fillStyle = color;
                ctx.fillRect(x, y - 30, Math.max(textWidth, confWidth) + 15, 30);
                
                ctx.fillStyle = "#000";
                ctx.fillText(label, x + 5, y - 12);
                ctx.font = "12px Arial";
                ctx.fillText(confLabel, x + 5, y - 2);
                ctx.font = "bold 16px Arial";
                
                const emoji = getEmoji(prediction.class);
                detectionsHTML += `
                    <div class="detection-item" style="border-left: 4px solid ${color};">
                        ${emoji} <span class="object-name">${prediction.class}</span> 
                        <span class="confidence">${confidence}%</span>
                    </div>
                `;
            });
        }
        
        if (classifications.length > 0) {
            detectionsHTML += '<div style="margin-top:15px; padding:10px; background:rgba(255,255,255,0.05); border-radius:5px;"><strong>ğŸ” Scene Analysis:</strong></div>';
            
            classifications.forEach((classification, index) => {
                const confidence = (classification.probability * 100).toFixed(0);
                if (confidence > 15) {
                    const color = colors[(cocoDetections.length + index) % colors.length];
                    currentObjects++;
                    detectionsHTML += `
                        <div class="detection-item" style="border-left: 4px solid ${color}; opacity:0.9;">
                            ğŸ¯ <span class="object-name">${classification.className}</span> 
                            <span class="confidence">${confidence}%</span>
                        </div>
                    `;
                }
            });
        }
        
        if (currentObjects === 0) {
            detectionsHTML = '<div class="detection-item" style="color:#888;">No objects detected - try different angle or better lighting</div>';
        }
        
        objectCountEl.textContent = currentObjects;
        totalDetections += currentObjects;
        totalDetectedEl.textContent = uniqueObjects.size;
        
        detectionsDiv.innerHTML = detectionsHTML;
        
        requestAnimationFrame(detectObjects);
    }

    function getEmoji(className) {
        const emojiMap = {
            'person': 'ğŸ‘¤', 'bicycle': 'ğŸš²', 'car': 'ğŸš—', 'motorcycle': 'ğŸï¸',
            'airplane': 'âœˆï¸', 'bus': 'ğŸšŒ', 'train': 'ğŸš†', 'truck': 'ğŸšš',
            'boat': 'â›µ', 'traffic light': 'ğŸš¦', 'stop sign': 'ğŸ›‘',
            'bench': 'ğŸª‘', 'bird': 'ğŸ¦', 'cat': 'ğŸ±', 'dog': 'ğŸ•',
            'horse': 'ğŸ´', 'sheep': 'ğŸ‘', 'cow': 'ğŸ„', 'elephant': 'ğŸ˜',
            'bear': 'ğŸ»', 'zebra': 'ğŸ¦“', 'giraffe': 'ğŸ¦’', 'backpack': 'ğŸ’',
            'umbrella': 'â˜‚ï¸', 'handbag': 'ğŸ‘œ', 'tie': 'ğŸ‘”', 'suitcase': 'ğŸ§³',
            'sports ball': 'âš½', 'bottle': 'ğŸ¾', 'cup': 'â˜•', 'fork': 'ğŸ´',
            'knife': 'ğŸ”ª', 'spoon': 'ğŸ¥„', 'bowl': 'ğŸ¥£', 'banana': 'ğŸŒ',
            'apple': 'ğŸ', 'sandwich': 'ğŸ¥ª', 'orange': 'ğŸŠ', 'pizza': 'ğŸ•',
            'donut': 'ğŸ©', 'cake': 'ğŸ°', 'chair': 'ğŸª‘', 'couch': 'ğŸ›‹ï¸',
            'bed': 'ğŸ›ï¸', 'toilet': 'ğŸš½', 'tv': 'ğŸ“º', 'laptop': 'ğŸ’»',
            'mouse': 'ğŸ–±ï¸', 'keyboard': 'âŒ¨ï¸', 'cell phone': 'ğŸ“±',
            'book': 'ğŸ“š', 'clock': 'ğŸ•', 'vase': 'ğŸº', 'scissors': 'âœ‚ï¸',
            'teddy bear': 'ğŸ§¸'
        };
        return emojiMap[className] || 'ğŸ“¦';
    }
})();
</script>
</body>
</html>
